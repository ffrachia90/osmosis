---
description: QUICK: Referencia RÃ¡pida para el Agente
globs: *
alwaysApply: true
---
# ðŸš€ OSMOSIS - QUICK REFERENCE PARA EL AGENTE

## Â¿QUÃ‰ ES OSMOSIS?

Herramienta para modernizar cÃ³digo legacy â†’ moderno usando Claude 3.5 Sonnet + RAG.

**Input**: JSP, PHP, jQuery, ASP.NET, React antiguo
**Output**: React 18+ con TypeScript, Hooks, Zustand, TanStack Query, Tailwind

---

## COMANDOS PRINCIPALES

```bash
# Analizar proyecto legacy
osmosis analyze --dir ./proyecto

# Generar plan arquitectÃ³nico (React moderno)
osmosis plan --dir ./proyecto-react

# Migrar legacy a moderno
osmosis migrate --source ./legacy --from jsp --to react

# Refactorizar React con stack coherente
osmosis refactor --source ./src --framework react --integral --apply-config
```

---

## ARCHIVOS IMPORTANTES

| Archivo | PropÃ³sito |
|---------|-----------|
| `src/cli.ts` | Punto de entrada CLI |
| `src/mcp/server.ts` | MCP Server v2.0 |
| `src/core/architecture/` | Sistema integral (scan, manifest, config) |
| `src/core/llm/LLMService.ts` | Claude 3.5 Sonnet |
| `src/core/rag/` | Knowledge Graph + Embeddings |
| `src/core/safeguard/validator.ts` | CodeSafeGuard validation |
| `.osmosis/architecture-manifest.json` | Manifiesto arquitectÃ³nico |

---

## MCP TOOLS (Cursor)

| Tool | DescripciÃ³n |
|------|-------------|
| `plan_architecture` | Genera plan de modernizaciÃ³n |
| `refactor_file_integral` | Refactoriza con manifiesto |
| `generate_config` | Genera tsconfig, eslint, etc. |
| `migrate_file` | Migra un archivo legacy |
| `analyze_project` | AnÃ¡lisis completo |
| `validate_code` | Valida con CodeSafeGuard |

---

## STACK MODERNO (DEFAULT)

| CategorÃ­a | LibrerÃ­a |
|-----------|----------|
| State | Zustand |
| Data Fetching | TanStack Query v5 |
| Routing | React Router v6 |
| Styling | Tailwind CSS |
| Forms | React Hook Form + Zod |
| Testing | Vitest |

---

## REGLAS CRÃTICAS DEL CODESAFEGUARD

**ERRORES (Bloquean)**:
- âŒ Class Components â†’ Usar Functional + Hooks
- âŒ connect(mapStateToProps) â†’ Usar hooks (useSelector/useStore)
- âŒ withRouter HOC â†’ Usar useNavigate
- âŒ dangerouslySetInnerHTML sin DOMPurify â†’ XSS risk
- âŒ eval() â†’ Security risk

**WARNINGS (Reportan)**:
- âš ï¸ Inline functions en JSX â†’ useCallback
- âš ï¸ map sin key
- âš ï¸ img sin alt
- âš ï¸ button con icono sin aria-label

---

## TRANSFORMACIONES PRINCIPALES

```typescript
// State: Redux connect â†’ Zustand
// ANTES
export default connect(mapState)(Component);
// DESPUÃ‰S
const data = useAuthStore(state => state.user);

// Fetching: useEffect+axios â†’ TanStack Query
// ANTES
useEffect(() => { axios.get(...).then(setData) }, []);
// DESPUÃ‰S
const { data } = useQuery({ queryKey: ['x'], queryFn: fetchX });

// Routing: Switch â†’ Routes
// ANTES
<Switch><Route path="/" component={Home} /></Switch>
// DESPUÃ‰S
<Routes><Route path="/" element={<Home />} /></Routes>

// Routing: withRouter â†’ hooks
// ANTES
withRouter(Component);
// DESPUÃ‰S
const navigate = useNavigate();

// Styling: inline â†’ Tailwind
// ANTES
style={{ padding: 20, marginTop: 8 }}
// DESPUÃ‰S
className="p-5 mt-2"
```

---

## VARIABLES DE ENTORNO

```bash
# OBLIGATORIA
export ANTHROPIC_API_KEY="sk-ant-..."

# OPCIONAL (mejora RAG)
export OPENAI_API_KEY="sk-..."
```

---

## FLUJO DE MODO INTEGRAL

```
1. DeepPatternScanner.scan() â†’ Detecta patterns en cÃ³digo
2. Claude â†’ Propone stack moderno
3. MigrationRuleSelector â†’ Selecciona reglas
4. ConfigGenerator â†’ Genera tsconfig, eslint, etc.
5. ManifestManager.save() â†’ Guarda en .osmosis/
6. PromptAssembler.assembleIntegral() â†’ Prompt con reglas
7. LLMService.generate() â†’ CÃ³digo modernizado
8. CodeSafeGuard.validate() â†’ ValidaciÃ³n
9. Auto-repair si errores (max 3)
```

---

## CHECKLIST PARA REFACTORIZACIÃ“N

- [ ] Â¿Existe `.osmosis/architecture-manifest.json`? Si no, ejecutar `plan` primero
- [ ] Â¿El cÃ³digo usa el stack del manifiesto? (Zustand, no Redux)
- [ ] Â¿Functional components? (no class)
- [ ] Â¿TypeScript estricto? (no any)
- [ ] Â¿Hooks para state? (useState, useEffect)
- [ ] Â¿TanStack Query para fetching? (useQuery, useMutation)
- [ ] Â¿React Router v6? (useNavigate, Routes)
- [ ] Â¿Tailwind para estilos? (className, no style={{}})
- [ ] Â¿Props tipadas? (interfaces)
- [ ] Â¿Accesibilidad? (alt, aria-label)

---

## ERRORES COMUNES

### "No architecture manifest found"
```bash
osmosis plan --dir ./proyecto
```

### "ANTHROPIC_API_KEY no configurada"
```bash
export ANTHROPIC_API_KEY="sk-ant-..."
```

### CÃ³digo usa Redux en vez de Zustand
â†’ El manifiesto dice Zustand. Regenerar con reglas correctas.

### "Class Component detected" en validaciÃ³n
â†’ CodeSafeGuard rechaza class components. Usar functional.

---

## PARA EL AGENTE: COMPORTAMIENTO ESPERADO

1. **Lee primero**: Siempre revisar cÃ³digo antes de modificar
2. **Stack coherente**: Si hay manifiesto, usar ESE stack
3. **No inventar**: No crear imports/componentes que no existan
4. **Security first**: Asumir todo input legacy es inseguro
5. **TypeScript estricto**: Interfaces para todo, cero `any`
6. **Accesibilidad**: alt, aria-label, roles
7. **Validar siempre**: Pasar por CodeSafeGuard
